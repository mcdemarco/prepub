<!DOCTYPE html>
<html>
	<head>
		<title>
			<%= name %>
		</title>
		<meta charset="utf-8">
		<script>
/**
 * PrePub <%= version %> - Twine Markdown Export Story Format
 * 
 * Copyright (c) 2017 - <%= year %> M. C. DeMarco
 * https://www.mcdemarco.net/tools/scree/prepub/
 *
 * This (MIT) license applies exclusively to the PrePub story format for Twine 2. No ownership of, 
 * nor licensing restrictions on, the content within the generated story are stated or implied.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
 * associated documentation files (the "Software"), to deal in the Software without restriction,
 * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial
 * portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT
 * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
		</script>

		<style>
		 .info, caption {font-style:italic;}
		 .info {color: #a5a5a5;}
		 .indent {padding-left: 1.5em;}
		 .info.indent {display:inline-block;}
		 p, table, div {padding-left: 3em;}
		 table {caption-side:top; color:#333;}
		 th, td {border: 1px solid #dedede; padding: 3px; text-align:center; font-weight:normal;}
		 td {font-size: x-large;}
		 sup {padding-left: 3px;}
		 .prepub-preview-mode {display:none;}
		</style>

	</head>
	<body>
		<h1>PrePub Conversion of {{STORY_NAME}}</h1>

		<p>Certain options may require the PrePub stylesheet.  You can also change centering, size, and capitalization of the headers there.</p>

		<h3>Headers</h3>

		<p>
			<input type="radio" id="nothing" name="numbering" value="nothing" />
			<label for="nothing">None </label>
			&nbsp;
			<span class="info"> There will be no header at all on passages.</span>
			<br/>
			<input type="radio" id="names" name="numbering" value="names" checked />
			<label for="names">Passage names</label>
			&nbsp;
			<span class="info"> Passage names will not be altered (<em>e.g.</em>, to upper case).</span>  
			<br/>
			<input type="radio" id="numbers" name="numbering" value="numbers" />
			<label for="numbers">Paragraph numbers </label>
			&nbsp;
			<span class="info"> Paragraph numbers are arbitrary (though sequential) and are not necessarily inserted into links.</span>  
			<br/>
			<input type="radio" id="symbol" name="numbering" value="symbol" />
			<label for="symbol">A character divider </label>
			&nbsp;
			<span class="info"> Use a numeric entity reference (<i>e.g.,</i> &amp;#167;), not a named reference (&amp;sect;).</span>
			<br/>
			<input type="radio" id="image" name="numbering" value="image" />
			<label for="image">An image divider </label>
			&nbsp;
			<span class="info"> Provide a path relative to the directory you will be running pandoc in.</span>
			<br/>
			<label for="symbolInput" class="indent">Divider entity or path: </label> 
			<input type="text" id="symbolInput" name="symbolInput" placeholder="&amp;#167;" value="" />

			<table>
				<caption>Sample character entities; see <a href="https://dev.w3.org/html5/html-author/charref" target="_blank">this page</a> for more.</caption>
				<tr><th>&amp;#42;</th><th>&amp;#167;</th><th>&amp;#182;</th><th>&amp;#183;</th><th>&amp;#8224;</th><th>&amp;#8225;</th><th>&amp;#8226;</th><th>&amp;#8727;</th><th>&amp;#8982;</th><th>&amp;#10535;</th><th>&amp;#10803;</th></tr>
				<tr><td>&#42;</td><td>&#167;</td><td>&#182;</td><td>&#183;</td><td>&#8224;</td><td>&#8225;</td><td>&#8226;</td><td>&#8727;</td><td>&#8982;</td><td>&#10535;</td><td>&#10803;</td></tr>
			</table>
		</p>


		<h3>Other Options</h3>
		<p>
			<input type="checkbox" id="shuffle" name="shuffle" value="1" />
			<label for="shuffle">Shuffle passages </label>
			&nbsp;
			<span class="info"> The start passage will remain at the beginning.</span>
		</p>
		<p>
			<input type="checkbox" id="rewrite" name="rewrite" value="1" />
			<label for="rewrite">Rewrite links </label>
			&nbsp;
			<span class="info"> Rewrite links to use paragraph numbers as specified below.  This requires paragraph numbering, above.</span>
			<br/>
			<span class="indent" style="display:inline-block;white-space:nowrap;">
				<input type="text" id="rewritePrefix"  name="rewritePrefix" placeholder="If you..." value="" /> <i>(existing link text)</i>
				<input type="text" id="rewritePostfix"  name="rewritePostfix" placeholder="...turn to paragraph " value="" /> <i>(paragraph number)</i>.
			</span>
		</p>
		<p>
			<input type="checkbox" id="tw2md" name="tw2md" />
			<label for="tw2md">Convert wiki-style markup to markdown from: </label><br/>
			<span class="indent" style="display:inline-block;white-space:nowrap;">
				<input type="radio" name="source" id="chapbook" value="chapbook" />
				<label for="chapbook">Chapbook</label><sup><a name="fs1" href="#fn1">1</a></sup>
				&nbsp;
				<input type="radio" name="source" id="harlowe" value="harlowe" checked/>
				<label for="harlowe">Harlowe</label><sup><a name="fs2" href="#fn2">2</a></sup>
				&nbsp;
				<input type="radio" name="source" id="sugarcube" value="sugarcube" />
				<label for="sugarcube">Sugarcube</label>
				&nbsp;
				<input type="radio" name="source" id="twine1" value="twine1" />
				<label for="twine1">Twine 1</label><sup><a name="fs3" href="#fn3">3</a></sup>
				&nbsp;
				<input type="radio" name="source" id="writingfantasy" value="writingfantasy" />
				<label for="writingfantasy">WritingFantasy</label><sup><a name="fs4" href="#fn4">4</a></sup>
			</span>
			<span class="indent" style="display:inline-block;white-space:nowrap;">
				<input type="checkbox" name="gordianbook" id="gordianbook" />
				<label for="gordianbook">Gordian Book</label><sup><a name="fs5" href="#fn5">5</a></sup>
			</span>
			<span class="info indent">
				This should only be necessary if you didn't use a purely Markdown-based story format like Snowman.
				(It does not convert macros or other scripting.)
			</span>
		</p>

		<h3>Download</h3>
		<p>
			<button type="button" id="downloadMarkdownButton">Download Markdown</button>
			<span class="info indent">See the PrePub README or <a href="http://mcdemarco.net/tools/scree/prepub/" target="_blank">web page</a> for help converting the downloaded markdown file to ePub using Pandoc and PrePub's stylesheet.</span>
		</p>

		<p class="prepub-preview-mode">
			<button type="button" id="downloadHtmlButton">Download HTML</button>
			<button type="button" id="downloadEpubButton">Download ePUB</button>

			<span class="info indent">If you are running a local Pandoc server, you can download the HTML preview below or an ePUB here, rather than using the command line.  The command line is recommended, however, and is required to generate PDFs.</span>
		</p>

		<section class="prepub-preview-mode">
		<h3>Preview HTML</h3>

		<p>
			<button type="button" id="refreshButton">Refresh</button>

			<span class="info indent">This is just an approximation of the sort of output you will get from Pandoc.</span>
		</p>

		<div>
			<iframe id="theFrame" style="width:99%;height:75vh;"></iframe>
		</div>
		</section>

		<hr/>
		<p>
			<sup><a name="fn1" href="#fs1">1</a></sup> Chapbook uses some minor non-Markdown markup. This option will also convert forks. <br/>
			<sup><a name="fn2" href="#fs2">2</a></sup> <a href="https://spiner.readme.io/docs/markdown">Spiner</a> claims that Harlowe uses Markdown, but it does not, so select Harlowe if you used Harlowe markup, and do not check this section at all if you used Markdown.<br/>
			<sup><a name="fn3" href="#fs3">3</a></sup> Twine 1 story formats used markup similar, but not identical, to Sugarcube's.  (Do not check this option if you are using a modern story format within the Twine 1 editor.)<br/>
			<sup><a name="fn4" href="#fs4">4</a></sup> <a href="https://sophiehoulden.com/twine/writingfantasy_guide.html#2">WritingFantasy</a> uses some minor non-Harlowe markup.<br/>
				<sup><a name="fn5" href="#fs5">5</a></sup> <a href="https://gordianbook.art/markdown">Gordian Book</a> has both Harlowe and Sugarcube options, so please select the appropriate one, and also check the Gordian Book box.<br/>
		</p>

		<pre id="output">
		
		</pre>
		<div id="storyData" style="display: none;">
			<%= passages %>
		</div>

		<%= script %>
	</body>
</html>
